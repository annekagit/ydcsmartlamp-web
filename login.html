<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>LoginÂ â€“Â YDCÂ Smartlamp</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:'SegoeÂ UI',sans-serif;background:linear-gradient(toÂ br,#dbeeff,#fff);display:flex;justify-content:center;align-items:center;height:100vh;margin:0}
    .container{background:#fff;padding:2rem;border-radius:12px;box-shadow:0Â 8pxÂ 16pxÂ rgba(0,0,0,.1);max-width:400px;width:100%}
    h1{text-align:center;color:#0077cc}
    input,button{width:100%;padding:.8rem;border-radius:8px;font-size:1rem}
    input{margin-top:1rem;border:1pxÂ solidÂ #ccc}
    button{margin-top:1.2rem;border:none;cursor:pointer;background:#0077cc;color:#fff}
    button:hover{background:#005fa3}
    .google-btn{background:#fff;color:#333;border:1pxÂ solidÂ #ccc;display:flex;align-items:center;justify-content:center}
    .google-btn img{height:20px;margin-right:10px}
    .status{text-align:center;margin-top:1rem;font-weight:bold}
    .link{text-align:center;margin-top:1rem}
    .linkÂ a{color:#0077cc;text-decoration:none}
    .linkÂ a:hover{text-decoration:underline}
  </style>

  <!--Â FirebaseÂ SDKÂ v8Â -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="firebase-config.js"></script>
</head>
<body>
  <div class="container">
    <h1>Login</h1>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="loginManual()">ğŸ”Â Login</button>
    <button class="google-btn" onclick="loginGoogle()">
      <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
      LoginÂ denganÂ Google
    </button>
    <div class="link"><a href="#" onclick="resetPassword()">ğŸ”Â LupaÂ Password?</a></div>
    <div class="status" id="status"></div>
    <div class="link">BelumÂ punyaÂ akun?Â <a href="register.html">Daftar</a></div>
  </div>

  <script>
    /*Â Simpan / perbarui data userÂ */
    function writeUserData(user){
      const ref = firebase.database().ref("users/"+user.uid);
      const now = Date.now();
      ref.once("value").then(snap=>{
        const exists = snap.exists();
        const data = {
          uid: user.uid,
          email: user.email || "",
          lastLogin: now
        };
        if(!exists){ data.createdAt = now; }
        // user sendiri selalu boleh update fieldÂ ini
        ref.update(data);
      }).catch(err=>console.error("SaveÂ userÂ err:",err));
    }

    /*Â Login ManualÂ */
    function loginManual(){
      const email=document.getElementById("email").value.trim();
      const pw=document.getElementById("password").value;
      const st=document.getElementById("status");
      if(!email||!pw){st.textContent="â—Â EmailÂ danÂ passwordÂ wajibÂ diisi.";st.style.color="red";return;}

      firebase.auth().signInWithEmailAndPassword(email,pw)
        .then(cred=>{writeUserData(cred.user);location.href="index.html";})
        .catch(err=>showErr(err,st));
    }

    /*Â Login GoogleÂ */
    function loginGoogle(){
      firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider())
        .then(res=>{writeUserData(res.user);location.href="index.html";})
        .catch(err=>{const s=document.getElementById("status");s.textContent="âš ï¸Â "+err.message;s.style.color="red";});
    }

    /*Â Reset PasswordÂ */
    function resetPassword(){
      const email=prompt("MasukkanÂ emailÂ untukÂ resetÂ password:");
      const st=document.getElementById("status");
      if(!email){st.textContent="â—Â EmailÂ tidakÂ bolehÂ kosong.";st.style.color="red";return;}
      firebase.auth().sendPasswordResetEmail(email)
        .then(()=>{st.textContent="ğŸ“§Â EmailÂ resetÂ dikirim.";st.style.color="green";})
        .catch(err=>{st.textContent="âŒÂ "+err.message;st.style.color="red";});
    }

    function showErr(err,el){
      const m={
        "auth/user-not-found":"âŒÂ EmailÂ belumÂ terdaftar.",
        "auth/wrong-password":"âŒÂ PasswordÂ salah.",
        "auth/invalid-email":"âŒÂ FormatÂ emailÂ tidakÂ valid.",
        "auth/too-many-requests":"âŒÂ TerlaluÂ banyakÂ percobaan.",
        "auth/user-disabled":"âŒÂ AkunÂ dinonaktifkan."
      };
      el.textContent=m[err.code]||"âŒÂ "+err.message;
      el.style.color="red";
    }

    /*Â Autoâ€‘redirectÂ jikaÂ sudahÂ loginÂ */
    firebase.auth().onAuthStateChanged(u=>{
      if(u){writeUserData(u);location.href="index.html";}
    });
  </script>
</body>
</html>
